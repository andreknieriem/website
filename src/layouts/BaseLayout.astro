---
const { title } = Astro.props;
const pathname = new URL(Astro.request.url).pathname;

// Helper function to determine if a link is active
const isActive = (path) => {
  if (path === '/') return pathname === '/';
  return pathname.startsWith(path);
};

// Import legacy SCSS
import '../styles/legacy.scss';
---
<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>{title} | André Rinas</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.png" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" href="/favicon.ico" />
  </head>
  <body id={pathname === '/' ? 'home' : ''}>
    <div id="stage">
      <div class="la-anim"></div>
      <header id="main-header">
        <button class="menu-btn">
          <i class="icon-Menu"></i>
          <i class="icon-Delete"></i>
        </button>

        <nav class="main-menu">
          <ul>
            <li role="presentation" class={isActive('/ueber-mich') ? 'active' : ''}><a href="/ueber-mich">Über mich</a></li>
            <li role="presentation" class={isActive('/portfolio') ? 'active' : ''}><a href="/portfolio">Portfolio</a></li>
            <li role="presentation" class={isActive('/tutorials') ? 'active' : ''}><a href="/tutorials">Tutorials</a></li>
            <li role="presentation" class={isActive('/playground') ? 'active' : ''}><a href="/playground">Playground</a></li>
            <li role="presentation"><a href="http://simplelightbox.js.org" target="_blank" rel="noreferrer">Simplelightbox</a></li>
            <li class="search">
              <div class="search-outer">
                <i class="icon-Search"></i>
                <div class="search-container">
                  <form method="get" action="/suche/" autocomplete="off">
                    <input type="search" name="q" class="search-input">
                    <button type="submit"><i class="icon-Forward"></i></button>
                  </form>
                </div>
              </div>
            </li>
          </ul>
        </nav>
        <a id="logo" title="André Rinas - Logo" href="/">&nbsp;</a>
      </header>

      <div id="content" data-pagefind-body>
        <div class="container">
            <slot /> <!-- Content is injected here -->
        </div>
      </div>
    </div>

    <footer>
      <div class="container">
        <div class="social">
          <a class="github" href="https://github.com/andreknieriem" target="_blank"><i class="icon-Github2"></i> Github</a>
          <a class="dribbble noliveloading" href="https://dribbble.com/andrerinas" target="_blank"><i class="icon-Dribbble"></i> Dribbble</a>
          <a class="twitter" href="https://twitter.com/andrerinas" target="_blank"><i class="icon-Twitter"></i> Twitter</a>
          <a class="contact" href="/kontakt"><i class="icon-Paper-Plane"></i> Kontakt</a>
        </div>
      </div>
    </footer>

    <div class="menu-overlay">
      <button class="menu-btn">
        <i class="icon-Menu"></i>
        <i class="icon-Delete"></i>
      </button>
    </div>

    <div class="mobile-menu">
        <div class="inner">
            <div class="msearch">
                <form method="get" action="/suche" autocomplete="off">
                    <button type="submit">
                        <i class="icon-Search"></i>
                    </button>
                    <input type="search" name="q" class="msearch-input" placeholder="Suche...">
                </form>
            </div>
            <div class="left-menu">
                <ul>
                    <li role="presentation" class={isActive('/portfolio') ? 'animate active' : 'animate'}><a href="/ueber-mich">Über mich</a></li>
                    <li role="presentation" class={isActive('/portfolio') ? 'animate active' : 'animate'}><a href="/portfolio">Portfolio</a></li>
                    <li role="presentation" class={isActive('/tutorials') ? 'animate active' : 'animate'}><a href="/tutorials">Tutorials</a></li>
                    <li role="presentation" class={isActive('/tutorials') ? 'animate active' : 'animate'}><a href="/tutorials">Playground</a></li>
                    <li role="presentation" class="animate"><a href="http://simplelightbox.js.org" target="_blank" rel="noreferrer">Simplelightbox</a></li>
                </ul>
            </div>
            <div class="right-menu">
                <ul>
                    <li role="presentation" class={isActive('/portfolio') ? 'animate active' : 'animate'}><a href="/ueber-mich">Über mich</a></li>
                    <li role="presentation" class={isActive('/portfolio') ? 'animate active' : 'animate'}><a href="/portfolio">Portfolio</a></li>
                    <li role="presentation" class={isActive('/tutorials') ? 'animate active' : 'animate'}><a href="/tutorials">Tutorials</a></li>
                    <li role="presentation" class={isActive('/tutorials') ? 'animate active' : 'animate'}><a href="/tutorials">Playground</a></li>
                    <li role="presentation" class="animate"><a href="http://simplelightbox.js.org" target="_blank" rel="noreferrer">Simplelightbox</a></li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const init = () => {
          // Mobile Menu
          const menuBtns = document.querySelectorAll('.menu-btn');
          const body = document.body;

          menuBtns.forEach(btn => {
              btn.addEventListener('click', () => {
                  // body.classList.toggle('open-menu');
                  if( !body.classList.contains('open-menu') ){ openMenu(); }
                  else { closeMenu(); }
              });
          });



          // Header Search Toggle
          const searchBtn = document.querySelector('.search .icon-Search');
          const searchLi = document.querySelector('.search');
          if (searchBtn && searchLi) {
            searchBtn.addEventListener('click', (e) => {
              e.preventDefault();
              e.stopPropagation();
              searchLi.classList.toggle('open');
              if (searchLi.classList.contains('open')) {
                searchLi.querySelector('input')?.focus();
              }
            });

            // Close search on click outside
            document.addEventListener('click', (e) => {
              if (!searchLi.contains(e.target as Node)) {
                searchLi.classList.remove('open');
              }
            });
          }

          checkHeader();

          const openMenu = () => {
            window.scrollTo(0,0);
            document.body.classList.add('open-menu');
            setTimeout(function(){
              document.querySelector('div.menu-overlay').classList.add('animate');
              let menuItems = document.querySelectorAll('.mobile-menu li');
              for (let element of menuItems) {
                element.classList.add('animate');
              }
            }, 50);
          }

          const closeMenu = () => {
            let menuItems = document.querySelectorAll('.mobile-menu li');
            for (let element of menuItems) {
              element.classList.remove('animate');
            }
            setTimeout(function(){
              document.body.classList.remove('open-menu');
              document.querySelector('div.menu-overlay').classList.remove('animate');
            }, 100);
          }

            // Common key handlers
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    body.classList.remove('open-menu');
                    searchLi?.classList.remove('active');
                }
            });
        };

        let throttled = false;
        window.addEventListener('resize', () => {
          if (!throttled) {
            handleResize();
            throttled = true;
            // set a timeout to un-throttle
            setTimeout( () => {
              throttled = false;
            }, 100 );
          }
        });

        const checkHeader = ()  => {
          let header = document.querySelector('header#main-header');
          let windowHeight = window.innerHeight,
            headerHeight = header.offsetHeight;

          if(!!document.getElementById("home")){
            if(windowHeight != headerHeight){
              header.style.height = windowHeight + 'px';
            }
          } else {
            header.removeAttribute('style');
          }
        }

        const handleResize = () => {
          checkHeader();
        }

        // Initialize on load
        init();
        // Support Astro page transitions if active
        document.addEventListener('astro:after-swap', init);
    </script>
  </body>
</html>
